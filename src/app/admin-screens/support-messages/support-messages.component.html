<app-alert
  *ngIf="showAlert"
  [message]="alertMessage"
  [type]="alertType"
  [duration]="4000"
></app-alert>

<h3>Support Center</h3>

<mat-expansion-panel style="width: 1230px; margin-bottom: 20px" expanded="true">
  <mat-expansion-panel-header>
    <div class="security-header">
      <img src="assets/history.png" alt="support-icon" class="user" />
      <p style="display: inline; margin-left: 5px">Support Center</p>
    </div>
  </mat-expansion-panel-header>

  <div *ngIf="dataSource.data.length > 0; else noSupport">
    <div class="table-container" style="margin-top: 10px">
      <table
        mat-table
        [dataSource]="dataSource"
        matSort
        class="mat-elevation-z8"
      >
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
          <td mat-cell *matCellDef="let x">{{ x.id }}</td>
        </ng-container>

        <!-- Account Number -->
        <ng-container matColumnDef="accountNumber">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Account #</th>
          <td mat-cell *matCellDef="let x">{{ x.accountNumber }}</td>
        </ng-container>

        <!-- User Name -->
        <ng-container matColumnDef="userName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>User Name</th>
          <td mat-cell *matCellDef="let x">{{ x.userName }}</td>
        </ng-container>

        <ng-container matColumnDef="supportArea">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Area</th>
          <td mat-cell *matCellDef="let x">
            {{ transformEnumValue(x.supportArea) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="supportDescription">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Description</th>
          <td mat-cell *matCellDef="let x">{{ x.supportDescription }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
          <td mat-cell *matCellDef="let x">
            {{ transformEnumValue(x.status) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Sent At</th>
          <td mat-cell *matCellDef="let x">
            {{ formatDate(x.createdAt) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let x">
            <button
              mat-button
              *ngIf="x.status === 'PENDING'"
              (click)="onReply(x)"
            >
              Reply
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          [ngClass]="{ 'resolved-row': row.status === 'RESOLVED' }"
        ></tr>
      </table>
    </div>
    <mat-paginator
      [pageSizeOptions]="dynamicPageSizeOptions"
      showFirstLastButtons
    ></mat-paginator>
  </div>

  <ng-template #noSupport>
    <div class="limited-info" style="text-align: center">
      <h3>No Support Requests Found</h3>
      <p>There are no support requests to display.</p>
    </div>
  </ng-template>
</mat-expansion-panel>

<app-reply-per-user
  *ngIf="showResponse"
  [supportId]="currentId"
  [description]="currentDesc"
  (closed)="onClosed()"
  (replied)="onReplied()"
></app-reply-per-user>
