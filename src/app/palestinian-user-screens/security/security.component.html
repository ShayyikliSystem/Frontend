<app-alert
  *ngIf="alertMessage"
  [message]="alertMessage"
  [type]="alertType"
></app-alert>
<h3>Security & Alerts</h3>

<mat-expansion-panel
  [ngStyle]="{ width: showWarning ? '100%' : '900px' }"
  style="margin-top: 10px; margin-bottom: 10px"
  expanded="true"
>
  <mat-expansion-panel-header style="margin-top: 10px; margin-bottom: 10px">
    <div class="security-header" style="margin-top: 10px">
      <img
        src="assets/history.png"
        alt="user"
        class="user"
        style="display: inline-block"
      />
      <p style="display: inline; margin-left: 5px">Log in History</p>
    </div>
  </mat-expansion-panel-header>

  <div *ngIf="showWarning" class="warning-alert">
    <img
      src="assets/exclamation circle copy.png"
      alt="Warning"
      class="warning-icon"
    />
    <div class="warning-text">
      <strong>Warning Message</strong>
      <p>
        Suspicious Attempts - There are many failed registration attempts.
        Protect your account by resetting your password now.
      </p>

      <button type="button" class="btn-secondary" (click)="onResetPassword()">
        Reset Password
      </button>
    </div>
  </div>

  <div class="filter-container">
    <mat-form-field appearance="outline">
      <mat-label>Status</mat-label>
      <mat-select [(ngModel)]="filterStatus" (selectionChange)="applyFilter()">
        <mat-option value="">All</mat-option>
        <mat-option value="success">Success</mat-option>
        <mat-option value="failed">Failed</mat-option>
      </mat-select>
      <button
        mat-icon-button
        *ngIf="filterStatus"
        matSuffix
        (click)="filterStatus = ''; applyFilter()"
        aria-label="Clear status filter"
      >
        <i class="bi bi-x-lg" style="font-size: 22px"></i>
      </button>
    </mat-form-field>

    <mat-form-field appearance="outline" style="margin-left: 20px">
      <mat-label>Choose a date</mat-label>
      <input
        matInput
        [matDatepicker]="picker"
        [(ngModel)]="filterDate"
        (dateChange)="applyFilter()"
      />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <button
        mat-icon-button
        *ngIf="filterDate"
        matSuffix
        (click)="filterDate = null; applyFilter()"
        aria-label="Clear date filter"
      >
        <i class="bi bi-x-lg" style="font-size: 22px"></i>
      </button>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>
  </div>

  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let log">
          <span
            [ngClass]="{
              success: log.status === 'success',
              failed: log.status === 'failed'
            }"
          >
            <img
              *ngIf="log.status === 'success'"
              src="assets/check circle.png"
              alt="Success"
              width="20"
              height="20"
            />
            <p *ngIf="log.status === 'success'" style="display: inline">
              Success
            </p>
            <img
              *ngIf="log.status === 'failed'"
              src="assets/exclamation circle.png"
              alt="Failed"
              width="20"
              height="20"
            />
            <p *ngIf="log.status === 'failed'" style="display: inline">
              Failed
            </p>
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
        <td mat-cell *matCellDef="let log">{{ log.date }}</td>
      </ng-container>

      <ng-container matColumnDef="ip_address">
        <th mat-header-cell *matHeaderCellDef>IP Address</th>
        <td mat-cell *matCellDef="let log">{{ log.ip_address }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
  <mat-paginator
    [pageSizeOptions]="dynamicPageSizeOptions"
    showFirstLastButtons
  >
  </mat-paginator>
  <p class="scroll-hint">
    If there are more rows than displayed, scroll within the table to view them.
  </p>
</mat-expansion-panel>

<app-confirm-reset
  *ngIf="showResetPassword"
  (confirmReset)="confirmResetPassword()"
  (cancelReset)="cancelResetPassword()"
></app-confirm-reset>
